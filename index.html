<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatibe" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    

    <h1><img src="img Among-Pixel_logo.png" alt="Among pixel logo" width="250px" style="display:block; margin:0 auto;" ></h1>

    <div id="cursor"></div>
    
    <canvas id="game" style="display:block; margin:0 auto; margin-bottom: 90px;" ></canvas>

    <header>
        <nav>
            <div class="toggle">
                <i class="fa-sharp fa-solid fa-chevron-down ouvrir"></i>
                <i class="fa-sharp fa-solid fa-xmark fermer"></i>
            </div>
            <ul class="menu">  
                <div id="colorsChoice"></div>          
        </nav>
    </header>

    </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="script.js"></script>


</body>
</html>





body {
    margin: 0%;
    background: url('Among-Background-pixel.png');
    height: 100%;
}

h1 {
    margin-bottom: 30px;
}

#game {
    width: 1200px;
    height: 600px;
    background-color: #ffffff;
    cursor: none;
}

header {
    position: absolute;
    width: 100%;
    height: 4vh;
    top: 0;
    right: 5px;
    color: #ffffff;
}

nav {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.menu {
    display: flex;
    justify-content: space-between;
    align-items: center;
    list-style: none;
    width: 500px;
}

.ouvrir {
    display: block;
}

.fermer {
    display: none;
}

.open .ouvrir {
    display: none;
}

.open .fermer {
    display: block;
}

.menu {
    position: absolute;
}

#colorsChoice {
    
    position: absolute;
    right: 5px;
    top: 60px;

    div{
        background-color: #ff5a5f;
        height: 15px;
        width: 15px;
        justify-content: space-between;
        align-items: center;
        border: 2px solid transparent;
        transition: all .3s;
        cursor: pointer;
        display: flex;
        color: #FFFFFF;

        &:hover{
            border-color: #ffffff;
        }
    }
}

#cursor{
    position: fixed;
    box-sizing: border-box; 
    width: 6px;
    height: 6px;
    background-color: transparent;
    border: 1px solid #000000;
    cursor: none;
}

#cursor::after {
    content: "";
    position: absolute;
    width: 2px;
    height: 2px;
    background-color: transparent;
    border: 1px solid #FFFFFF;
}








const colorsChoice = document.querySelector('#colorsChoice');
const game = document.querySelector('#game');
const cursor = document.querySelector('#cursor');
game.width = 1200;
game.height = 600;
const gridCellSize = 6;

let toggle = document.querySelector('.toggle');
let body = document.querySelector('body');

toggle.addEventListener('click', function(){
    body.classList.toggle('open');
})

const ctx = game.getContext('2d');
const gridCtx = game.getContext('2d');

const colorList = [
    "#FF4500", "#FFA800", "#FFD635", "#00A368", "#BE0039", "#FF3881", "#6D001A", "#FFF8B8", 
    "#7EED56", "#2450A4", "#3690EA", "#51E9F4", "#00756F", "#009EAA", "#00CCC0", "#94B3FF",
    "#811E9F", "#B44AC0", "#FF99AA", "#9C6926", "#493AC1", "#6A5CFF", "#E4ABFF", "#DE107F",
    "#FFFFFF", "#D4D7D9", "#898D90", "#000000", "#00CC78", "#6D482F", "#FFB470", "#515252",
]
let currentColorChoice = colorList[9]


const firebaseConfig = {
  apiKey: "AIzaSyB4GKUhNvU-s0LrWdmqIISZahicnJs5nvw",
  authDomain: "among-pixel-fr.firebaseapp.com",
  projectId: "among-pixel-fr",
  storageBucket: "among-pixel-fr.appspot.com",
  messagingSenderId: "822671089310",
  appId: "1:822671089310:web:bb93afaa5d7e779761258f"
};
firebase.initializeApp(firebaseConfig)
const db = firebase.firestore()

colorList.forEach(color => {
    const colorItem = document.createElement('div')
    colorItem.style.backgroundColor = color
    colorsChoice.appendChild(colorItem)

    colorItem.addEventListener('click', () => {
        currentColorChoice = color

        colorItem.innerHTML = '<i class="fa-solid fa-check"></i>'

        setTimeout(() => {
            colorItem.innerHTML = ""
        }, 1000)
    })
})

function createPixel(x, y, color){
    ctx.beginPath()
    ctx.fillStyle = color
    ctx.fillRect(x, y, gridCellSize, gridCellSize)
}

function addPixelIntoGame(){
    const x = cursor.offsetLeft - game.offsetLeft
    const y = cursor.offsetTop - game.offsetTop
    
    createPixel(x, y, currentColorChoice)

    const pixel = {
        x,
        y,
        color: currentColorChoice
    }

    const pixelRef = db.collection('pixel').doc(`${pixel.x}-${pixel.y}`)
    pixelRef.set(pixel, { merge: true })
}

cursor.addEventListener('click', function (event) {
    addPixelIntoGame()
})
game.addEventListener('click', function(){
    addPixelIntoGame()
})


function drawGrids(ctx, width, height, cellWidth, cellHeight){
    ctx.beginPath()
    ctx.strokeStyle = "transparent"

    for(let i = 0; i < width; i++){
        ctx.moveTo(i * cellWidth, 0)
        ctx.lineTo(i * cellWidth, height)
    }

    for(let i = 0; i < height; i++){
        ctx.moveTo(0, i * cellHeight)
        ctx.lineTo(width, i * cellHeight)
    }
    ctx.stroke()
}
drawGrids(gridCtx, game.width, game.height, gridCellSize, gridCellSize)

game.addEventListener('mousemove', function(event){
    console.log(" x :", event.clientX)
    console.log(" y :", event.clientY)

    const cursorLeft = event.clientX - (cursor.offsetWidth / 2)
    const cursorTop = event.clientY - (cursor.offsetHeight / 2)

    cursor.style.left = Math.floor(cursorLeft / gridCellSize) * gridCellSize + "px"
    cursor.style.top = Math.floor(cursorTop / gridCellSize) * gridCellSize + "px"

})

db.collection('pixel').onSnapshot(function(querySnapshot){
    querySnapshot.docChanges().forEach(function(change){
        const { x, y, color } = change.doc.data()

        createPixel(x, y, color)
    })
})